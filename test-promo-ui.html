<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Promo Code UI</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .test-section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        input { padding: 10px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; width: 200px; }
    </style>
</head>
<body>
    <h1>üéüÔ∏è Promo Code Functionality Test</h1>
    
    <div class="test-section">
        <h2>API Test Results</h2>
        <div id="api-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Manual Promo Code Test</h2>
        <p>Test the promo codes manually:</p>
        
        <div style="margin: 10px 0;">
            <input type="text" id="promoInput" placeholder="Enter promo code" value="TELESCOPE2025">
            <button class="btn-primary" onclick="testPromoCode()">Validate Code</button>
        </div>
        
        <div style="margin: 10px 0;">
            <label>Order Amount: $</label>
            <input type="number" id="orderAmount" placeholder="79.90" value="79.90" step="0.01">
        </div>
        
        <div id="test-results"></div>
        
        <div style="margin-top: 20px;">
            <h3>Available Test Codes:</h3>
            <ul>
                <li><code>TELESCOPE2025</code> - 3 months free (educators)</li>
                <li><code>PAPERCLIP</code> - 1 month free (general)</li>
                <li><code>MIDNIGHT50</code> - 50% off first month</li>
                <li><code>DEVTEST</code> - 12 months free (dev)</li>
            </ul>
        </div>
    </div>

    <script>
        // Test API on page load
        async function runAPITests() {
            const resultsDiv = document.getElementById('api-results');
            
            try {
                // Test TELESCOPE2025
                const response = await fetch('/api/promo/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: 'TELESCOPE2025', orderAmount: 7990 })
                });
                
                const result = await response.json();
                
                if (response.ok && result.valid) {
                    resultsDiv.innerHTML = '<div class="success">‚úÖ API is working! TELESCOPE2025 validated successfully.</div>';
                } else {
                    resultsDiv.innerHTML = '<div class="error">‚ùå API validation failed: ' + (result.error || 'Unknown error') + '</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">‚ùå API request failed: ' + error.message + '</div>';
            }
        }
        
        // Manual test function
        async function testPromoCode() {
            const code = document.getElementById('promoInput').value;
            const amount = parseFloat(document.getElementById('orderAmount').value) * 100; // Convert to cents
            const resultsDiv = document.getElementById('test-results');
            
            if (!code) {
                resultsDiv.innerHTML = '<div class="error">Please enter a promo code</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div>Testing code: ' + code + '...</div>';
            
            try {
                const response = await fetch('/api/promo/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: code, 
                        orderAmount: amount,
                        userId: null,
                        fingerprintHash: 'test_fingerprint_' + Date.now()
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.valid) {
                        let html = '<div class="success">‚úÖ Valid Code!</div>';
                        html += '<div><strong>Name:</strong> ' + result.promoCode.name + '</div>';
                        html += '<div><strong>Type:</strong> ' + result.promoCode.type + '</div>';
                        html += '<div><strong>Description:</strong> ' + result.promoCode.description + '</div>';
                        
                        if (result.discountPreview) {
                            html += '<div><strong>Original:</strong> $' + (result.discountPreview.originalAmount / 100).toFixed(2) + '</div>';
                            html += '<div><strong>Discount:</strong> $' + (result.discountPreview.discountAmount / 100).toFixed(2) + '</div>';
                            html += '<div><strong>Final:</strong> $' + (result.discountPreview.finalAmount / 100).toFixed(2) + '</div>';
                        }
                        
                        resultsDiv.innerHTML = html;
                    } else {
                        resultsDiv.innerHTML = '<div class="error">‚ùå Invalid Code: ' + result.error + '</div>';
                    }
                } else {
                    resultsDiv.innerHTML = '<div class="error">‚ùå API Error: ' + response.status + '</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">‚ùå Request Failed: ' + error.message + '</div>';
            }
        }
        
        // Keyboard shortcut
        document.getElementById('promoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testPromoCode();
            }
        });
        
        // Run API tests on page load
        runAPITests();
    </script>
</body>
</html>